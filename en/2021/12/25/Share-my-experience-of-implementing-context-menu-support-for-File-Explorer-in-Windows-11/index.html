<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/en/../img/favicon.png"><link rel="icon" href="/en/../img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Kenji Mouri"><meta name="keywords" content=""><meta name="description" content="Hi, I’m Kenji Mouri, the creator of NanaZip, it may be the first third-party open-source file archiver which implements context menu support for File Explorer in Windows 11. I want to share my  experi"><meta property="og:type" content="article"><meta property="og:title" content="Share my experience of implementing context menu support for File Explorer in Windows 11"><meta property="og:url" content="https://mourinaruto.github.io/en/2021/12/25/Share-my-experience-of-implementing-context-menu-support-for-File-Explorer-in-Windows-11/index.html"><meta property="og:site_name" content="Kenji Mouri"><meta property="og:description" content="Hi, I’m Kenji Mouri, the creator of NanaZip, it may be the first third-party open-source file archiver which implements context menu support for File Explorer in Windows 11. I want to share my  experi"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-12-25T23:52:36.000Z"><meta property="article:modified_time" content="2022-12-29T03:53:55.194Z"><meta property="article:author" content="Kenji Mouri"><meta property="article:tag" content="Technologies"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Windows Apps"><meta property="article:tag" content="Development"><meta property="article:tag" content="Experience"><meta name="twitter:card" content="summary_large_image"><title>Share my experience of implementing context menu support for File Explorer in Windows 11 - Kenji Mouri</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/en/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2188012_jkjop06z1g.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"mourinaruto.github.io",root:"/en/",version:"1.8.14",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:1280544492,leancloud:{app_id:"qEO7L1QVXqw752KnQk88IfDS-MdYXbMMI",app_key:"fEqb7CwIp1LJnuHKnhRlI2wh",server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/en/local-search.xml"}</script><script src="/en/js/utils.js"></script><script src="/en/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/en/"><strong>Kenji Mouri</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/en/"><i class="iconfont icon-home-fill"></i> Home</a></li><li class="nav-item"><a class="nav-link" href="/en/archives/"><i class="iconfont icon-archive-fill"></i> Archives</a></li><li class="nav-item"><a class="nav-link" href="/en/categories/"><i class="iconfont icon-category-fill"></i> Categories</a></li><li class="nav-item"><a class="nav-link" href="/en/tags/"><i class="iconfont icon-tags-fill"></i> Tags</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://github.com/MouriNaruto/MouriDocs"><i class="iconfont icon-book"></i> Docs</a></li><li class="nav-item"><a class="nav-link" href="https://mourinaruto.github.io/zh/"><i class="iconfont icon-book"></i> 中文</a></li><li class="nav-item"><a class="nav-link" href="/en/about/"><i class="iconfont icon-user-fill"></i> About</a></li><li class="nav-item"><a class="nav-link" href="/en/links/"><i class="iconfont icon-link-fill"></i> Links</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/en/../img/background.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Share my experience of implementing context menu support for File Explorer in Windows 11"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-12-25 23:52" pubdate>December 25, 2021 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.4k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 28 minutes</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Share my experience of implementing context menu support for File Explorer in Windows 11</h1><div class="markdown-body"><p>Hi, I’m Kenji Mouri, the creator of <a target="_blank" rel="noopener" href="https://github.com/M2Team/NanaZip">NanaZip</a>, it may be the first third-party open-source file archiver which implements context menu support for File Explorer in Windows 11. I want to share my experience in this article because many friends ask me for learning how to implement that since I have released NanaZip 1.0 Preview 1.</p><p>Many users and developers may notice that the context menus from their favourite apps won’t show in the context menu in Windows 11, which is implemented with XAML Islands. They need to click “Show more options” in the new context menu for accessing the context menu item they want to use via the legacy context menu.</p><p>I noticed it when Microsoft released the first insider preview of Windows 11 in late June, and I had waited for two months and found no third-party file archiver which implements context menu support for File Explorer in Windows 11. I thought I need to create a file archiver to improve my user experience when I use Windows 11 in my main rig after October 5, 2021, because as a professional Windows desktop app developer, I need to pay attention to the latest Windows platform. Because I am a 7-Zip enthusiast, so I forked the source code tree of 7-Zip.</p><h2 id="The-requirements-for-implementing-context-menu-support-for-File-Explorer-in-Windows-11"><a href="#The-requirements-for-implementing-context-menu-support-for-File-Explorer-in-Windows-11" class="headerlink" title="The requirements for implementing context menu support for File Explorer in Windows 11"></a>The requirements for implementing context menu support for File Explorer in Windows 11</h2><p>According to <a target="_blank" rel="noopener" href="https://blogs.windows.com/blog/2021/07/19/extending-the-context-menu-and-share-dialog-in-windows-11/">the article posted in Windows Blog</a>, we know that we need to use IExplorerCommand to implement the context menu and make it run under the app identity.</p><p>There are two ways for getting app identity, packaging the full app into the MSIX package or use Sparse Manifests if you want to make your app unpackaged. So, the AppX manifest is required.</p><h2 id="Implement-the-IExplorerCommand-interface"><a href="#Implement-the-IExplorerCommand-interface" class="headerlink" title="Implement the IExplorerCommand interface"></a>Implement the IExplorerCommand interface</h2><p>I think implement a simple context menu with the IExplorerCommand interface is easy, but due to the limitations of the IExplorerCommand interface, we can’t implement something like preview images in the context menu.</p><p>Also, we can only show 16 items for maximum in one context menu handler, I have used the Google but I can’t find any documents from Microsoft for describing the limitation. But I know the separator is not counted in the limitation, and you can define multiple context menu handlers to bypass the limitation.</p><p>As we all know, the context menu in Windows 11 will cascade items from apps with more than 1 verb. So I suggest you make your context menu only in cascaded mode for a universal user experience when the user uses the legacy context menu via clicking “Show more options”.</p><h2 id="The-choices-when-I-implement-the-NanaZip"><a href="#The-choices-when-I-implement-the-NanaZip" class="headerlink" title="The choices when I implement the NanaZip"></a>The choices when I implement the NanaZip</h2><p>I had chosen packaging NanaZip into the MSIX package because I wanted to submit it to the Microsoft Store.</p><p>Due to the limitations of the context menu in Windows 11, NanaZip only have the cascaded mode and merge CRC SHA items into the archiver items and split them with the separator.</p><h2 id="My-suggestions-for-Microsoft"><a href="#My-suggestions-for-Microsoft" class="headerlink" title="My suggestions for Microsoft"></a>My suggestions for Microsoft</h2><p>I hope we have a modern way to implement the drag-and-drop context menu.</p><p>The App Model should be more polished, many Windows instances can’t load the context menu from third-party packaged app before restarting the File Explorer via Task Manager.</p><h2 id="Afterword"><a href="#Afterword" class="headerlink" title="Afterword"></a>Afterword</h2><p>As a 7-Zip enthusiast and an open-source lover. I want everyone not only to know this is a 7-Zip derivative, but also to make people know it’s a project created by me.</p><p>I have searched for a proper name for half a month, and finally I decided to use NanaZip as the name of file archiver. Here are the reasons.</p><ul><li>All names of the user-oriented open-source projects created by myself is started with the <code>N</code> letter because my ID is <code>MouriNaruto</code>, some of my friends use <code>N-series</code> to call projects created by me.</li><li><code>Nana</code> is the romaji of <code>なな</code>, means seven in Japanese. It will make people know NanaZip is a 7-Zip derivative if they know a little Japanese because this is a pun which is easy to understand.</li><li>The return value of <code>strlen(&quot;NanaZip&quot;)</code> is 7, it’s also a nice pun.</li></ul><p>This is the first article of development stories from projects created or maintained by me. I will write more.</p><p>I hope the article can give some help for Windows desktop app developers. Thanks for reading.</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/en/categories/Technologies/">Technologies</a> <a class="hover-with-bg" href="/en/categories/Technologies/Windows/">Windows</a> <a class="hover-with-bg" href="/en/categories/Technologies/Windows/Windows-Apps/">Windows Apps</a> <a class="hover-with-bg" href="/en/categories/Technologies/Windows/Windows-Apps/Development/">Development</a> <a class="hover-with-bg" href="/en/categories/Technologies/Windows/Windows-Apps/Development/Experience/">Experience</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/en/tags/Technologies/">Technologies</a> <a class="hover-with-bg" href="/en/tags/Windows/">Windows</a> <a class="hover-with-bg" href="/en/tags/Windows-Apps/">Windows Apps</a> <a class="hover-with-bg" href="/en/tags/Development/">Development</a> <a class="hover-with-bg" href="/en/tags/Experience/">Experience</a></div></div><p class="note note-warning">Unless otherwise stated, all articles in this blog follow the <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="nofollow noopener noopener">CC BY-NC-ND 4.0 license</a>, please indicate the source for reprinting!</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/en/2021/12/26/Set-Windows-Application-Packaging-project-with-multiple-referenced-projects-to-a-common-output-folder/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Set Windows Application Packaging project with multiple referenced projects to a common output folder</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/en/2021/11/25/Use-VC-LTL-in-your-Cpp-WinRT-UWP-projects/"><span class="hidden-mobile">Use VC-LTL in your C++/WinRT UWP projects</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><script type="text/javascript">Fluid.utils.loadComments("#comments",(function(){var t=document.documentElement.getAttribute("data-user-color-scheme");t="dark"===t?"github-dark":"github-light",window.UtterancesThemeLight="github-light",window.UtterancesThemeDark="github-dark";var e=document.createElement("script");e.setAttribute("src","https://utteranc.es/client.js"),e.setAttribute("repo","MouriNaruto/MouriNaruto"),e.setAttribute("issue-term","pathname"),e.setAttribute("label","blog"),e.setAttribute("theme",t),e.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(e)}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">Total number of visits: <span id="leancloud-site-pv"></span> </span><span id="leancloud-site-uv-container" style="display:none">Total number of visitors: <span id="leancloud-site-uv"></span></span></div><span id="cnzz_stat_icon_1280544492" style="display:none"></span></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/en/js/events.js"></script><script src="/en/js/plugins.js"></script><script src="/en/js/local-search.js"></script><script src="/en/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script defer src="/en/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script defer src="//s4.cnzz.com/z_stat.php?id=1280544492&show=pic" type="text/javascript"></script><script src="/en/js/boot.js"></script></body></html>